function p(e,n){if("."===n)return e[e.length-1];for(let t=e.length-1;0<=t;t--){var r=e[t];if("object"==typeof r&&r.hasOwnProperty(n))return r[n]}}function d(n,r,i,s){var o=[];let l=0;for(;l<n.length;){var t=n.indexOf(r,l);if(-1===t){o.push(n.substring(l,n.length));break}var u=n.substring(l,t),u=(0<u.length&&o.push(u),n.indexOf(i,t+r.length));if(-1===u)throw`Found open tag at position ${t} but found no close tag`;let e=n.substring(t+r.length,u).trim();if(l=u+i.length,e.startsWith("!"))console.debug("Comment",e.substring(1).trim());else if(e.startsWith("#")||e.startsWith("^")){var t=e.startsWith("^"),{stopTagIndex:u,nextCurrentIndex:h}=(e=e.substring(1).trim(),function(e,n,r,i,t){let s=t;for(var o=[];s<e.length;){var l=e.indexOf(n,s);if(-1===l)return;var u=e.indexOf(r,l+n.length);if(-1===u)throw"Could not find close index";let t=e.substring(l+n.length,u);if(t.startsWith("#")||t.startsWith("^"))t=t.substring(1).trim(),o.push(t);else if(t.startsWith("/")){if(t=t.substring(1).trim(),0===o.length&&t===i)return{stopTagIndex:l,nextCurrentIndex:u+r.length};l=o.pop();if(l!==t)throw`Found end tag for ${t} when expecting `+l}s=u+r.length}}(n,r,i,e,l));if(-1===u)throw"Could not find end tag for "+e;var a=p(s,e),g=null==a||!1===a;if(t&&g)void 0!==a&&s.push(a),o.push(d(n.substring(l,u),r,i,s)),void 0!==a&&s.pop();else if(!t&&!g)if(Array.isArray(a)){var f=n.substring(l,u);for(let t=0;t<a.length;t++)s.push(a[t]),o.push(d(f,r,i,s)),s.pop()}else"function"==typeof a?o.push(a.call(null,n.substring(l,u),t=>d(t,r,i,s))):(s.push(a),o.push(d(n.substring(l,u),r,i,s)),s.pop());l=h}else{if(e.startsWith("/"))throw"Encountered unexpected end tag "+(e=e.substring(1).trim());if(e.startsWith(">")){e=e.substring(1).trim();t=document.getElementById(e);if(!t)throw`Could not find element with id ${e} to use as partial`;o.push(d(t.innerText,r,i,s))}else if(e.startsWith("=")&&e.endsWith("=")){g=e.substring(1,e.length-1).trim().match(/^([^ =]+)[ ]+([^ =]+)$/);if(!g)throw"Expected new tags but could not find them";r=g[1],i=g[2]}else{let t=!0;e.startsWith("&")?(t=!1,e=e.substring(1).trim()):e.startsWith(r.charAt(0))&&n.charAt(l)===i.charAt(i.length-1)&&(t=!1,e=e.substring(1).trim(),l++);u=p(s,e);void 0!==u&&(h=""+("function"==typeof u?u.call(null):u),t?o.push(h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")):o.push(h))}}}return o.join("")}export default function(t){if(null==t)throw"No options or template defined";let e;var n,r;if("string"==typeof t?(e=t,t={}):e=t.template,e)return n=t.open||"{{",r=t.close||"}}",d(e,n,r,[t.data||{}]);throw"Template not defined"}