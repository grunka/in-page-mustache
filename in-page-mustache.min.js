function p(t,e){return"."===e?t[t.length-1]:void 0!==(t=t.findLast(t=>"object"==typeof t&&null!==t[e]))?t[e]:void 0}function d(n,r,i,s){var o=[];let l=0;for(;l<n.length;){var t=n.indexOf(r,l);if(-1===t){o.push(n.substring(l,n.length));break}var u=n.substring(l,t),u=(0<u.length&&o.push(u),n.indexOf(i,t+r.length));if(-1===u)throw`Found open tag at position ${t} but found no close tag`;let e=n.substring(t+r.length,u).trim();if(l=u+i.length,e.startsWith("!"))console.debug("Comment",e.substring(1).trim());else if(e.startsWith("#")||e.startsWith("^")){var t=e.startsWith("^"),{stopTagIndex:u,nextCurrentIndex:a}=(e=e.substring(1).trim(),function(e,n,r,i,t){let s=t;for(var o=[];s<e.length;){var l=e.indexOf(n,s);if(-1===l)return;var u=e.indexOf(r,l+n.length);if(-1===u)throw"Could not find close index";let t=e.substring(l+n.length,u);if(t.startsWith("#")||t.startsWith("^"))t=t.substring(1).trim(),o.push(t);else if(t.startsWith("/")){if(t=t.substring(1).trim(),0===o.length&&t===i)return{stopTagIndex:l,nextCurrentIndex:u+r.length};l=o.pop();if(l!==t)throw`Found end tag for ${t} when expecting `+l}s=u+r.length}}(n,r,i,e,l));if(-1===u)throw"Could not find end tag for "+e;var h=p(s,e),g=null==h||!1===h;if(t&&g)void 0!==h&&s.push(h),o.push(d(n.substring(l,u),r,i,s)),void 0!==h&&s.pop();else if(!t&&!g)if(Array.isArray(h)){var f=n.substring(l,u);for(let t=0;t<h.length;t++)s.push(h[t]),o.push(d(f,r,i,s)),s.pop()}else"function"==typeof h?o.push(h.call(null,n.substring(l,u),t=>d(t,r,i,s))):(s.push(h),o.push(d(n.substring(l,u),r,i,s)),s.pop());l=a}else{if(e.startsWith("/"))throw"Encountered unexpected end tag "+(e=e.substring(1).trim());if(e.startsWith(">")){e=e.substring(1).trim();t=document.getElementById(e);if(!t)throw`Could not find element with id ${e} to use as partial`;o.push(d(t.innerText,r,i,s))}else{let t=!0;e.startsWith("&")?(t=!1,e=e.substring(1).trim()):e.startsWith(r.charAt(0))&&n.charAt(l)===i.charAt(i.length-1)&&(t=!1,e=e.substring(1).trim(),l++);g=p(s,e);void 0!==g&&(u=""+("function"==typeof g?g.call(null):g),t?o.push(u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")):o.push(u))}}}return o.join("")}export default function(t){if(null==t)throw"No options or template defined";let e;var n,r;if("string"==typeof t?(e=t,t={}):e=t.template,e)return n=t.open||"{{",r=t.close||"}}",d(e,n,r,[t.data||{}]);throw"Template not defined"}