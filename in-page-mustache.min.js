(()=>{function e(t,n){n=n||{open:"{{",close:"}}"};let s=[],i={name:null,negated:!1,startIndex:0,endIndex:t.length,items:[]},r=(e,t)=>{let n=e.findLast(e=>"object"==typeof e&&null!==e[t]);return void 0!==n?n[t]:void 0},l=0;for(;l<t.length;){let o=t.indexOf(n.open,l);if(-1!==o){let a=t.substring(l,o);a.length>0&&i.items.push(a);let p=t.indexOf(n.close,o+n.open.length);if(-1===p)throw`Found open tag at position ${o} but found no close tag`;let h=t.substring(o+n.open.length,p).trim();if(l=p+n.close.length,h.startsWith("!"));else if(h.startsWith("#")||h.startsWith("^")){let g=h.substring(1),u={name:g,negated:h.startsWith("^"),startIndex:l,items:[]};i.items.push(u),s.push(i),i=u}else if(h.startsWith("/")){let d=h.substring(1);if(i.name!==d)throw`End tag ${d} encountered when expecting ${i.name}`;if(s.length<1)throw"No renderer on stack when popping";i.endIndex=o,i=s.pop()}else if(h.startsWith(">")){let f=h.substring(1).trim(),c=document.getElementById(f);if(!c)throw`Could not find element with id ${f} to use as partial`;i.items.push({name:f,negated:!1,partial:c.innerText})}else{let m=h,_=!0;h.startsWith("&")?(_=!1,m=h.substring(1).trim()):h.startsWith(n.open.charAt(0))&&t.charAt(l)===n.close.charAt(n.close.length-1)&&(_=!1,m=h.substring(1).trim(),l++),i.items.push(e=>{let t;if(void 0===(t="."===m?e[e.length-1]:r(e,m)))return"";let n=""+("function"==typeof t?t.call(null):t);return _?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):n})}}else{let b=t.substring(l,t.length);i.items.push(b),l=t.length}}return{render:s=>(function s(i,l){let o="";for(let a=0;a<i.items.length;a++){let p=i.items[a];if("string"==typeof p)o+=p;else if("function"==typeof p)o+=p(l);else if("object"==typeof p){if(p.partial)o+=e(p.partial,n).render(l);else{let h=r(l,p.name);p.negated&&void 0===h||!1===h?(l.push(h),o+=s(p,l),l.pop()):p.negated||void 0===h||(Array.isArray(h)?(l.push(h),h.forEach(e=>{l.push(e),o+=s(p,l),l.pop()}),l.pop()):"function"==typeof h?o+=h.call(null,t.substring(p.startIndex,p.endIndex),t=>e(t,n).render(l)):(l.push(h),o+=s(p,l),l.pop()))}}else throw`Unrecognized type ${typeof p}`}return o})(i,Array.isArray(s)?s:[s])}}window.InPageMustache={parse:e}})();
