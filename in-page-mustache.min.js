function d(n,r){if("."===r)return n[n.length-1];r=r.split(".");for(let t=n.length-1;0<=t;t--){let e=n[t];for(let t=0;t<r.length&&"object"==typeof e;t++)if(e.hasOwnProperty(r[t])&&(e=e[r[t]],t===r.length-1))return e}}function c(n,r,i,s,l){var o=[];let u=0;for(;u<n.length;){var t=n.indexOf(r,u);if(-1===t){o.push(n.substring(u,n.length));break}var h=n.substring(u,t),h=(0<h.length&&o.push(h),n.indexOf(i,t+r.length));if(-1===h)throw`Found open tag at position ${t} but found no close tag`;let e=n.substring(t+r.length,h).trim();if(u=h+i.length,e.startsWith("!"))console.debug("Comment",e.substring(1).trim());else if(e.startsWith("#")||e.startsWith("^")){var t=e.startsWith("^"),{stopTagIndex:h,nextCurrentIndex:a}=(e=e.substring(1).trim(),function(e,n,r,i,t){let s=t;for(var l=[];s<e.length;){var o=e.indexOf(n,s);if(-1===o)return;var u=e.indexOf(r,o+n.length);if(-1===u)throw"Could not find close index";let t=e.substring(o+n.length,u);if(t.startsWith("#")||t.startsWith("^"))t=t.substring(1).trim(),l.push(t);else if(t.startsWith("/")){if(t=t.substring(1).trim(),0===l.length&&t===i)return{stopTagIndex:o,nextCurrentIndex:u+r.length};o=l.pop();if(o!==t)throw`Found end tag for ${t} when expecting `+o}s=u+r.length}}(n,r,i,e,u));if(-1===h)throw"Could not find end tag for "+e;var g=d(l,e),f=null==g||!1===g;if(t&&f)void 0!==g&&l.push(g),o.push(c(n.substring(u,h),r,i,s,l)),void 0!==g&&l.pop();else if(!t&&!f)if(Array.isArray(g)){var p=n.substring(u,h);for(let t=0;t<g.length;t++)l.push(g[t]),o.push(c(p,r,i,s,l)),l.pop()}else"function"==typeof g?o.push(g.call(null,n.substring(u,h),t=>c(t,r,i,s,l))):(l.push(g),o.push(c(n.substring(u,h),r,i,s,l)),l.pop());u=a}else{if(e.startsWith("/"))throw"Encountered unexpected end tag "+(e=e.substring(1).trim());if(e.startsWith(">")){e=e.substring(1).trim();t=s.call(null,e);o.push(c(t,r,i,s,l))}else if(e.startsWith("=")&&e.endsWith("=")){f=e.substring(1,e.length-1).trim().match(/^([^ =]+)[ ]+([^ =]+)$/);if(!f)throw"Expected new tags but could not find them";r=f[1],i=f[2]}else{let t=!0;e.startsWith("&")?(t=!1,e=e.substring(1).trim()):e.startsWith(r.charAt(0))&&n.charAt(u)===i.charAt(i.length-1)&&(t=!1,e=e.substring(1).trim(),u++);h=d(l,e);void 0!==h&&(a=""+("function"==typeof h?h.call(null):h),t?o.push(a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")):o.push(a))}}}return o.join("")}export default function(t){if(null==t)throw"No options or template defined";let e;var n,r,i;if("string"==typeof t?(e=t,t={}):e=t.template,e)return n=t.open||"{{",r=t.close||"}}",i=t.partialLookup||(t=>{var e=document.getElementById(t);if(e)return e.innerText;throw`Could not find element with id ${t} to use as partial`}),c(e,n,r,i,[t.data||{}]);throw"Template not defined"}